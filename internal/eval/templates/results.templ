package templates

import "fmt"

type EvalStat struct {
	RunID       int
	EvalID      string
	ModelID     string
	Status      string
	PassedCount int
	TotalCount  int
	PassRate    float64
	TotalTokens int64
	TotalCost   float64
}

type ResultsProps struct {
	Stats []EvalStat
	Error string
}

templ ResultsTable(stats []EvalStat) {
	<div class="overflow-x-auto">
		<table class="min-w-full divide-y divide-gray-200">
			<thead class="bg-gray-50">
				<tr>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Evaluation</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Model</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pass Rate</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tokens</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cost</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
				</tr>
			</thead>
			<tbody class="bg-white divide-y divide-gray-200">
				for _, stat := range stats {
					<tr>
						<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
							{ stat.EvalID }
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							{ stat.ModelID }
						</td>
						<td class="px-6 py-4 whitespace-nowrap">
							@StatusBadge(stat.Status)
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							if stat.TotalCount > 0 {
								{ fmt.Sprintf("%d/%d (%.1f%%)", stat.PassedCount, stat.TotalCount, stat.PassRate) }
							} else {
								{ "--" }
							}
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							{ fmt.Sprintf("%d", stat.TotalTokens) }
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							{ fmt.Sprintf("$%.4f", stat.TotalCost) }
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
							<a href={ "/results/" + fmt.Sprintf("%d", stat.RunID) } class="text-blue-600 hover:text-blue-900">
								View Details
							</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
}

templ Results(props ResultsProps) {
	<div class="space-y-6">
		<h2 class="text-2xl font-bold">Evaluation Results</h2>
		if props.Error != "" {
			@Alert(props.Error, "error")
		}
		if len(props.Stats) == 0 {
			<div class="text-center py-12">
				<h3 class="mt-2 text-sm font-medium text-gray-900">No results available</h3>
				<p class="mt-1 text-sm text-gray-500">Run some evaluations to see results here.</p>
				<div class="mt-6">
					<a href="/evals" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
						Run Evaluations
					</a>
				</div>
			</div>
		}
		if len(props.Stats) > 0 {
			@ResultsTable(props.Stats)
		}
	</div>
}
